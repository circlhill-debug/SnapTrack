<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SnapTrack — USPS OCR</title>
  <style>
    :root{--ink:#111;--muted:#6b7280;--line:#e5e7eb;--bg:#f8fafc}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
    .wrap{max-width:720px;margin:0 auto;padding:20px}
    h1{font-size:1.75rem;margin:0 0 .25rem}
    .card{background:#fff;border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
    button{cursor:pointer;border:1px solid #d1d5db;background:#fff;padding:10px 14px;border-radius:12px}
    button.primary{background:#111;color:#fff;border-color:#111}
    button:active{transform:scale(.99)}
    .muted{color:var(--muted)}
    .grid{display:grid;gap:16px}
    .img{width:100%;border:1px solid var(--line);border-radius:12px}
    textarea{width:100%;height:150px;border:1px solid var(--line);border-radius:12px;padding:10px;font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;font-size:.9rem}
    .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}
    .pill{display:inline-block;font-size:.75rem;padding:.25rem .5rem;border-radius:999px;border:1px solid #d1d5db}
    label.switch{display:flex;align-items:center;gap:.5rem;font-size:.9rem}
    .list > button{width:100%;text-align:left}
    .good{background:#ecfdf5;border-color:#a7f3d0}
    .bad{background:#fef2f2;border-color:#fecaca;color:#b91c1c}
  </style>
</head>
<body>
  <div class="wrap">
    <header style="margin-bottom:16px">
      <h1>SnapTrack — USPS OCR</h1>
      <p class="muted">Snap or upload a USPS label, crop if needed, I’ll read the tracking number, then open the official USPS tracking page.</p>
    </header>

    <div class="grid">
      <!-- (Capture / Upload section stays the same as your working version) -->

      <!-- Candidates -->
      <section class="card">
        <div style="display:flex;justify-content:space-between;gap:12px;align-items:center">
          <div>
            <h3 style="margin:.25rem 0">2) Candidates found</h3>
            <p class="muted" style="margin:0">Tap a number to open USPS in a new tab.</p>
          </div>
          <label class="switch">
            <input type="checkbox" id="autoOpen" checked />
            <span class="pill">Auto-open if only one</span>
          </label>
        </div>
        <div id="best" class="card good" style="margin-top:12px;display:none">
          <div class="muted" style="font-size:.75rem;font-weight:700;text-transform:uppercase;margin-bottom:4px">Best match</div>
          <div id="bestNum" class="mono" style="font-size:1.15rem;word-break:break-all"></div>
          <div style="margin-top:8px;display:flex;gap:8px">
            <button class="primary" id="openBest">Open on USPS</button>
            <button id="copyBest">Copy</button>
          </div>
        </div>
        <div id="many" class="list" style="margin-top:12px;display:grid;gap:8px"></div>

        <!-- Manual Paste Box -->
        <div class="card" style="margin-top:12px">
          <h4 style="margin:.25rem 0">Manual (paste or edit)</h4>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <input id="manualInput" class="mono" placeholder="Paste tracking number…" 
                   style="flex:1;min-width:220px;padding:10px;border:1px solid var(--line);border-radius:10px" />
            <button id="openManual" class="primary">Open on USPS</button>
          </div>
          <p class="muted" style="margin:.5rem 0 0">Tip: copy from “Raw OCR” and paste here if needed.</p>
        </div>
      </section>

      <!-- Raw OCR -->
      <section class="card">
        <h3 style="margin:.25rem 0">3) Raw OCR (troubleshooting)</h3>
        <textarea id="raw" readonly></textarea>
      </section>
    </div>
  </div>

  <!-- Tesseract.js OCR (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <script>
    // (all your existing JS remains unchanged...)

    // --- Manual Paste Box logic ---
    const manualInput = document.getElementById('manualInput');
    const openManual  = document.getElementById('openManual');

    openManual.addEventListener('click', () => {
      const val = (manualInput.value || '').trim().toUpperCase();
      if (!val) return;

      // Clean spaces/dashes if numeric
      const cleaned = /^[A-Z]{2}\d{9}US$/i.test(val) ? val : val.replace(/\D+/g,'');
      if (!cleaned) return;

      openUSPS(cleaned);
    });
  </script>
</body>
</html>
